# RouteEditor 利用者の手引

**バージョン**: 1.0
**作成日**: 2025年09月30日

---

## 目次

1. [はじめに](#1-はじめに)
2. [起動方法](#2-起動方法)
3. [画面構成](#3-画面構成)
4. [基本操作](#4-基本操作)
5. [GeoJSONファイルの読み込み](#5-geojsonファイルの読み込み)
6. [GeoJSONファイルの出力](#6-geojsonファイルの出力)
7. [地図の操作方法](#7-地図の操作方法)
8. [マーカーの見方](#8-マーカーの見方)
9. [トラブルシューティング](#9-トラブルシューティング)
10. [よくある質問](#10-よくある質問)

---

## 1. はじめに

### 1.1 RouteEditorとは
RouteEditorは、国土地理院の地図上でGPS座標データ（GeoJSON形式）を視覚的に確認・管理するためのWebアプリケーションです。

### 1.2 主な用途
- ハイキングルートのGPSデータの確認
- 地図上でのポイント・ルート・スポットの表示
- GeoJSONデータの入出力管理
- 複数のGPS座標データの統合確認

### 1.3 必要な環境
- **ブラウザ**: Chrome 90+、Edge 90+、Firefox 89+、Safari 14+
- **インターネット接続**: 地図タイルの読み込みに必要
- **ローカルサーバー**: 開発環境での動作に必要

---

## 2. 起動方法

### 2.1 ローカル環境での起動

**ステップ1: ローカルサーバーを起動**

RouteEditorはES6モジュールを使用しているため、ローカルHTTPサーバーが必要です。

**Pythonを使う場合:**
```bash
# RouteEditorフォルダに移動
cd /path/to/RouteEditor

# ローカルサーバーを起動
python -m http.server 8000
```

**npxを使う場合:**
```bash
# RouteEditorフォルダに移動
cd /path/to/RouteEditor

# ローカルサーバーを起動
npx serve .
```

**ステップ2: ブラウザでアクセス**

ブラウザで以下のURLを開きます:
```
http://localhost:8000
```

### 2.2 Webサーバーでの公開（オプション）

RouteEditorをWebサーバーに配置すれば、URLアクセスだけで使用できます。

---

## 3. 画面構成

### 3.1 全体レイアウト

```
┌─────────────────────────────────────────────────┐
│                                   ┌───────────┐ │
│                                   │ 制御パネル│ │
│                                   │           │ │
│           地図エリア              │モード選択 │ │
│     （国土地理院地図）            │           │ │
│                                   │GeoJSON    │ │
│                                   │入出力     │ │
│                                   │           │ │
│                                   │統計情報   │ │
│                          ┌─┐     └───────────┘ │
│                          │+│                     │
│                          ├─┤                     │
│                          │-│                     │
│                          └─┘                     │
│                        ズーム                    │
│                      ┌────────┐                  │
│                      │1km     │                  │
│                      └────────┘                  │
│                      スケール                    │
└─────────────────────────────────────────────────┘
```

### 3.2 制御パネル（右上）

**モード選択**（現在は「ファイルの入出力(GeoJSON)」のみ実装）:
- ○ ファイルの入出力(GeoJSON) ← 現在実装済み
- ○ ルートの位置編集 ← 未実装
- ○ スポットの位置編集 ← 未実装

**GeoJSONファイルの入出力パネル**:
```
┌──────────────────────────────┐
│ GeoJSONファイルの入出力      │
├──────────────────────────────┤
│ [読み込み]  ファイル    0    │
│ [出力]      ポイント    0 点 │
│             ルート      0 本 │
│             スポット    0 個 │
└──────────────────────────────┘
```

### 3.3 地図コントロール（右下）

- **ズームボタン**: 地図の拡大・縮小
  - **[+]**: ズームイン（拡大）
  - **[-]**: ズームアウト（縮小）
- **スケール**: 地図上の距離を示すスケールバー

---

## 4. 基本操作

### 4.1 地図の初期表示

アプリケーションを起動すると、箕面大滝（大阪府箕面市）を中心とした地図が表示されます。

- **初期中心座標**: 北緯34.853667度、東経135.472041度
- **初期ズームレベル**: 15（詳細表示）

### 4.2 操作の流れ

1. **ファイル読み込み**: GeoJSONファイルを選択して読み込む
2. **地図確認**: 地図上に表示されたポイント・ルート・スポットを確認
3. **統計確認**: 制御パネルで件数を確認
4. **ファイル出力**: 必要に応じてGeoJSONファイルを出力

---

## 5. GeoJSONファイルの読み込み

### 5.1 読み込み手順

**ステップ1: 読み込みボタンをクリック**

制御パネルの「読み込み」ボタンをクリックします。

**ステップ2: ファイルを選択**

ファイル選択ダイアログが開くので、読み込みたいGeoJSONファイル（`.geojson` または `.json`）を選択します。

**ステップ3: 自動表示**

- 地図上にデータが表示されます
- 地図範囲が自動的にデータ全体を含むように調整されます
- 統計情報（ポイント数、ルート数、スポット数）が更新されます
- 画面中央に「GeoJSONファイルを読み込みました」というメッセージが3秒間表示されます

### 5.2 対応ファイル形式

- **拡張子**: `.geojson`, `.json`
- **形式**: GeoJSON FeatureCollection
- **座標系**: WGS84（EPSG:4326）
- **文字エンコーディング**: UTF-8

### 5.3 読み込みエラー

以下の場合、エラーメッセージが表示されます（6秒間）:

- ファイル形式が不正
- JSON構文エラー
- GeoJSON構造が不正

**エラーメッセージ例**:
```
ファイルの読み込みに失敗しました: Unexpected token ...
```

---

## 6. GeoJSONファイルの出力

### 6.1 出力手順

**ステップ1: データを読み込む**

先にGeoJSONファイルを読み込んでおく必要があります。

**ステップ2: 出力ボタンをクリック**

制御パネルの「出力」ボタンをクリックします。

**ステップ3: 保存場所を選択**

**Chrome/Edge等（File System Access API対応ブラウザ）の場合:**
- 保存ダイアログが表示されます
- 読み込んだフォルダが自動的に提案されます
- ファイル名: `MapGPS-yyyymmdd.geojson`（例: `MapGPS-20250930.geojson`）
- 保存場所を選択して「保存」をクリック

**Firefox/Safari等（非対応ブラウザ）の場合:**
- ブラウザのデフォルトダウンロードフォルダに自動保存されます
- ファイル名は同じく `MapGPS-yyyymmdd.geojson` 形式

**ステップ4: 完了メッセージ**

画面中央に「GeoJSONファイルを出力しました」というメッセージが3秒間表示されます。

### 6.2 出力ファイル名

- **フォーマット**: `MapGPS-yyyymmdd.geojson`
- **日付**: 出力した日付（システム日付）
- **例**:
  - 2025年9月30日に出力 → `MapGPS-20250930.geojson`
  - 2025年10月1日に出力 → `MapGPS-20251001.geojson`

### 6.3 出力エラー

**データ未読み込みの場合:**

GeoJSONファイルを読み込んでいない状態で「出力」ボタンをクリックすると、以下のメッセージが表示されます（4.5秒間）:

```
出力するデータがありません。先にGeoJSONファイルを読み込んでください。
```

**保存キャンセルの場合:**

保存ダイアログでキャンセルした場合、メッセージは表示されません。

---

## 7. 地図の操作方法

### 7.1 パン（移動）操作

- **マウス**: 地図をドラッグして移動
- **タッチデバイス**: 地図をスワイプして移動

### 7.2 ズーム操作

**ズームボタンを使う:**
- 右下の **[+]** ボタンをクリック → 拡大
- 右下の **[-]** ボタンをクリック → 縮小

**マウスホイールを使う:**
- マウスホイールを上に回す → 拡大
- マウスホイールを下に回す → 縮小

**ダブルクリックで拡大:**
- 地図をダブルクリックした場所を中心に拡大

**タッチデバイスのピンチ操作:**
- 2本指でピンチアウト → 拡大
- 2本指でピンチイン → 縮小

### 7.3 マーカーのポップアップ

地図上のマーカー（ポイント・ルート中間点・スポット）をクリックすると、名前がポップアップ表示されます。

**例**:
- ポイント「東海道自然歩道」をクリック → 「東海道自然歩道」と表示

---

## 8. マーカーの見方

地図上に表示されるマーカーは、フィーチャータイプによって色と形状が異なります。

### 8.1 マーカータイプ一覧

| タイプ | 色 | 形状 | サイズ | 説明 |
|--------|-----|------|--------|------|
| **ポイントGPS** | 緑色 | ● 円形 | 半径6px | 実測GPS座標（標高含む） |
| **ルート中間点** | 橙色 | ◆ 菱形 | 8x8px | ルート上の中間地点 |
| **スポット** | 青色 | ■ 正方形 | 12x12px | 休憩所・施設などの地点 |
| **ルート** | 青色 | ─ 線 | 線幅3px | LineString/MultiLineString |
| **エリア** | 青色 | □ 面 | - | Polygon/MultiPolygon |

### 8.2 マーカーの色

```
緑色 ●  = ポイントGPS（実測座標）
橙色 ◆  = ルート中間点
青色 ■  = スポット
青色 ─  = ルート・エリア
```

### 8.3 統計情報の見方

制御パネルの統計情報は、読み込んだGeoJSONファイルの内容をリアルタイムで表示します。

| 項目 | 単位 | 説明 |
|------|------|------|
| ファイル | - | 読み込まれているファイル数（0または1） |
| ポイント | 点 | ポイントGPSの数 |
| ルート | 本 | LineString/MultiLineStringの本数（またはルート中間点のルートID数） |
| スポット | 個 | スポットポイント + Polygon/MultiPolygonの数 |

---

## 9. トラブルシューティング

### 9.1 地図が表示されない

**原因**: インターネット接続がない、またはローカルサーバーが起動していない

**対処法**:
1. インターネット接続を確認
2. ローカルサーバーが起動しているか確認
3. ブラウザのコンソールでエラーメッセージを確認

### 9.2 ファイルが読み込めない

**原因1**: ファイル形式が不正

**対処法**:
- GeoJSON形式（RFC 7946準拠）であることを確認
- JSON構文エラーがないかチェック

**原因2**: 文字エンコーディングが不正

**対処法**:
- ファイルがUTF-8エンコーディングであることを確認

### 9.3 マーカーが表示されない

**原因1**: 座標が日本国外

**対処法**:
- 座標値が正しいか確認（経度: 123-146度、緯度: 24-46度程度）

**原因2**: ジオメトリタイプが不正

**対処法**:
- `geometry.type` が `"Point"`, `"LineString"`, `"Polygon"` 等の有効な値であることを確認

### 9.4 ファイルが出力できない

**原因**: データが読み込まれていない

**対処法**:
- 先にGeoJSONファイルを読み込む

### 9.5 CORS エラーが表示される

**エラーメッセージ例**:
```
Access to script at 'file:///.../app.js' from origin 'null' has been blocked by CORS policy
```

**原因**: ローカルサーバーを使用していない

**対処法**:
- ローカルHTTPサーバーを起動する（`python -m http.server 8000` または `npx serve .`）
- `file://` プロトコルではなく `http://localhost:8000` でアクセスする

---

## 10. よくある質問

### Q1. 複数のGeoJSONファイルを同時に読み込めますか？

**A**: いいえ、現在のバージョンでは1ファイルずつの読み込みのみ対応しています。新しいファイルを読み込むと、前のファイルのデータは消去されます。

### Q2. 読み込んだデータを編集できますか？

**A**: 現在のバージョンでは、データの表示・確認のみ対応しています。編集機能（ルート・スポットの位置編集）は将来のバージョンで実装予定です。

### Q3. 出力ファイル名を変更できますか？

**A**: Chrome/Edge等のFile System Access API対応ブラウザでは、保存ダイアログでファイル名を変更できます。非対応ブラウザでは、ダウンロード後に手動でリネームしてください。

### Q4. オフラインで使用できますか？

**A**: いいえ、国土地理院の地図タイルを読み込むためインターネット接続が必要です。

### Q5. スマートフォン・タブレットで使用できますか？

**A**: はい、タッチ操作（スワイプ、ピンチ）に対応しています。ただし、画面サイズが小さい場合は制御パネルが見にくい場合があります。

### Q6. 読み込んだファイルと同じフォルダに出力できますか？

**A**: Chrome/Edge等のFile System Access API対応ブラウザでは、ブラウザが最後に使用したフォルダを記憶し、保存ダイアログで提案されます。Firefox/Safari等では、ブラウザのデフォルトダウンロードフォルダに保存されます。

### Q7. 他の地図（Google Maps等）を使えますか？

**A**: 現在のバージョンでは国土地理院地図のみ対応しています。他の地図タイルへの変更は、`js/constants.js` の `GSI_TILE_URL` を編集することで可能です（開発者向け）。

### Q8. ポイント・ルート・スポットの色を変更できますか？

**A**: 現在のバージョンではUIからの変更はできません。色の変更は、`js/constants.js` の `FEATURE_STYLES` を編集することで可能です（開発者向け）。

### Q9. GeoJSON以外のファイル形式（KML、GPX等）に対応していますか？

**A**: いいえ、現在はGeoJSON形式のみ対応しています。

### Q10. データのバックアップは必要ですか？

**A**: RouteEditorは読み込んだデータを変更しませんが、念のため元のGeoJSONファイルは別途保管することをお勧めします。

---

## 11. 参考情報

### 11.1 関連ドキュメント

- [機能仕様書](funcspec-202509.md) - 詳細な技術仕様
- [GeoJSONデータ仕様書](dataspec-geojson.md) - データ構造の詳細
- [プロジェクト概要（開発者向け）](../CLAUDE.md) - 開発者向け情報

### 11.2 外部リンク

- [Leaflet.js公式ドキュメント](https://leafletjs.com/)
- [国土地理院地図](https://maps.gsi.go.jp/)
- [GeoJSON仕様（RFC 7946）](https://datatracker.ietf.org/doc/html/rfc7946)

---

## 12. サポート・お問い合わせ

本アプリケーションに関するご質問・ご要望は、プロジェクト管理者までお問い合わせください。

---

## 13. バージョン履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-09-30 | 初版作成 |

---

**本ドキュメントの最終更新日**: 2025年09月30日